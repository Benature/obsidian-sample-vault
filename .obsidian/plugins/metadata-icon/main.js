/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MetadataIcon
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// src/i18n/en.ts
var EN = {
  settingAddIconName: "Add custom entry icon",
  settingAddIconDesc: "Input entry name and icon url. The image will be automatically loaded on the left side. If there is no image shown on the left side, please check the image link.",
  settingAddIconTooltip: "Add new icon",
  settingAddIconDescElSpan: "icon preview:",
  settingAddIconPlaceholderEntry: "entry name",
  settingAddIconPlaceholderImage: "image link",
  settingRemoveIconTooltip: "Delete"
};

// src/i18n/zh.ts
var ZH = {
  settingAddIconName: "\u6DFB\u52A0\u81EA\u5B9A\u4E49\u56FE\u6807",
  settingAddIconDesc: "\u8F93\u5165\u6587\u6863\u5C5E\u6027\u540D\u79F0\u548C\u56FE\u6807\u94FE\u63A5\u3002\u56FE\u6807\u5C06\u5728\u5DE6\u4FA7\u81EA\u52A8\u9884\u89C8\uFF0C\u5982\u679C\u5DE6\u4FA7\u6CA1\u6709\u663E\u793A\u56FE\u7247\uFF0C\u8BF7\u68C0\u67E5\u56FE\u7247\u94FE\u63A5\u662F\u5426\u6B63\u786E\u3002",
  settingAddIconTooltip: "\u6DFB\u52A0\u65B0\u56FE\u6807",
  settingAddIconDescElSpan: "\u56FE\u6807\u9884\u89C8\uFF1A",
  settingAddIconPlaceholderEntry: "\u6587\u6863\u5C5E\u6027\u540D\u79F0",
  settingAddIconPlaceholderImage: "\u56FE\u6807\u94FE\u63A5",
  settingRemoveIconTooltip: "\u5220\u9664"
};

// src/i18n/zh-tw.ts
var ZHtw = {
  settingAddIconName: "\u65B0\u589E\u81EA\u5B9A\u7FA9\u5716\u793A",
  settingAddIconDesc: "\u8F38\u5165\u6587\u4EF6\u5C6C\u6027\u540D\u7A31\u548C\u5716\u793A\u93C8\u63A5\u3002\u5716\u793A\u5C07\u5728\u5DE6\u5074\u81EA\u52D5\u9810\u89BD\uFF0C\u5982\u679C\u5DE6\u5074\u6C92\u6709\u986F\u793A\u5716\u7247\uFF0C\u8ACB\u6AA2\u67E5\u5716\u7247\u93C8\u63A5\u662F\u5426\u6B63\u78BA\u3002",
  settingAddIconTooltip: "\u65B0\u589E\u5716\u793A",
  settingAddIconDescElSpan: "\u5716\u793A\u9810\u89BD\uFF1A",
  settingAddIconPlaceholderEntry: "\u6587\u4EF6\u5C6C\u6027\u540D\u7A31",
  settingAddIconPlaceholderImage: "\u5716\u793A\u93C8\u63A5",
  settingRemoveIconTooltip: "\u5220\u9664"
};

// src/i18n/i18n.ts
var Locals = class {
  static get() {
    const lang = window.localStorage.getItem("language");
    switch (lang) {
      case "zh":
        return ZH;
      case "zh-tw":
        return ZHtw;
      default:
        return EN;
    }
  }
};

// main.ts
var DEFAULT_SETTINGS = {
  IconAttrList: []
};
var MetadataIcon = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new MetadataHiderSettingTab(this.app, this));
    await genSnippetCSS(this);
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
function genEntryCSS(s) {
  const selector = `data-property-key="${s.entry}"`;
  let body = [
    `.metadata-property[${selector}] .metadata-property-key::after {`,
    `	content: "";`,
    `	background-image: url("${s.image}");`,
    `	background-size: 20px;`,
    `	width: 20px;`,
    `	height: 20px;`,
    `	position: absolute;`,
    `	left: 3px;`,
    `	top: 6px;`,
    `	z-index: -100;`,
    `	opacity: 0.5;`,
    `	background-repeat: no-repeat;`,
    `}`,
    `.metadata-property[${selector}] svg {`,
    `	visibility: hidden;`,
    `}`,
    ``
  ];
  return body.join("\n");
}
async function genSnippetCSS(plugin) {
  const content = [
    "/* * WARNING: This file will be overwritten by plugin `Metadata Icon`.",
    "   * DO NOT EDIT THIS FILE DIRECTLY!!!",
    "   * Do not edit this file directly!!!",
    "*/",
    "",
    ".setting-item-description:has(.metadata-icon-preview) {",
    "	display: flex;",
    "	align-items: center;",
    "	justify-content: space-around;",
    "}",
    ""
  ];
  plugin.settings.IconAttrList.forEach((iconSetting, index) => {
    content.push(genEntryCSS(iconSetting));
  });
  const vault = plugin.app.vault;
  const ob_config_path = vault.configDir;
  const snippets_path = ob_config_path + "/snippets";
  const css_filename = "metadata-icon-auto-gen";
  const path = `${snippets_path}/${css_filename}.css`;
  if (!await vault.adapter.exists(snippets_path)) {
    await vault.adapter.mkdir(snippets_path);
  }
  if (await vault.adapter.exists(path)) {
    await vault.adapter.remove(path);
  }
  await plugin.app.vault.create(path, content.join("\n"));
  const customCss = plugin.app.customCss;
  customCss.enabledSnippets.add(css_filename);
  customCss.requestLoadSnippets();
}
var MetadataHiderSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
    this.debouncedGenerate = (0, import_obsidian.debounce)(this.generateSnippet, 1e3, true);
  }
  async generateSnippet() {
    await genSnippetCSS(this.plugin);
  }
  display() {
    const { containerEl } = this;
    const t = Locals.get();
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName(t.settingAddIconName).setDesc(t.settingAddIconDesc).addButton((button) => {
      button.setTooltip("Add new icon").setButtonText("+").setCta().onClick(async () => {
        this.plugin.settings.IconAttrList.push({
          entry: "",
          image: ""
        });
        await this.plugin.saveSettings();
        this.display();
      });
    });
    this.plugin.settings.IconAttrList.forEach((iconSetting, index) => {
      const s = new import_obsidian.Setting(this.containerEl);
      let span = s.descEl.createEl("span", { text: t.settingAddIconDescElSpan });
      span.setAttribute("style", `margin-right: 2px; `);
      let img = s.descEl.createEl("img", { cls: "metadata-icon-preview" });
      img.setAttribute("src", iconSetting.image);
      img.setAttribute("width", `20px`);
      img.setAttribute("style", `background-color: transparent;`);
      s.addSearch((cb) => {
        cb.setPlaceholder(t.settingAddIconPlaceholderEntry).setValue(iconSetting.entry).onChange(async (newValue) => {
          this.plugin.settings.IconAttrList[index].entry = newValue;
          await this.plugin.saveSettings();
          this.debouncedGenerate();
        });
      });
      s.addSearch((cb) => {
        cb.setPlaceholder(t.settingAddIconPlaceholderImage).setValue(iconSetting.image).onChange(async (newValue) => {
          img.setAttribute("src", newValue);
          this.plugin.settings.IconAttrList[index].image = newValue;
          await this.plugin.saveSettings();
          this.debouncedGenerate();
        });
      });
      s.addExtraButton((cb) => {
        cb.setIcon("cross").setTooltip(t.settingRemoveIconTooltip).onClick(async () => {
          this.plugin.settings.IconAttrList.splice(index, 1);
          await this.plugin.saveSettings();
          this.display();
          this.debouncedGenerate();
        });
      });
    });
  }
};
